<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Crumple</title>
    <style>
    body {
        margin: 0;
        padding: 0;
        background: #000;
        overflow: hidden;
    }
    canvas {
        width: 100%;
        height: 100%
    }
    </style>
</head>
<body>
<script src="bower_components/delaunay-fast/delaunay.js"></script>
<script src="bower_components/threejs/build/three.min.js"></script>
<script>
window.onload = function () {
    var sw = window.innerWidth,
        sh = window.innerHeight,
        scene = new THREE.Scene(),
        camera = new THREE.PerspectiveCamera(75, sw / sh, 0.1, 1000),
        renderer = new THREE.WebGLRenderer();

    renderer.setSize(sw, sh);

    document.body.appendChild(renderer.domElement);

    var geometry = new THREE.Geometry(),
        density = 15;

    geometry.vertices.push(
        new THREE.Vector3(0, 0, 0),
        new THREE.Vector3(1, 0, 0),
        new THREE.Vector3(1, 1, 0),
        new THREE.Vector3(0, 1, 0)
    );

    for (var i = 0; i < density; i++) {
        geometry.vertices.push(
            new THREE.Vector3(Math.random(), 0, 0),
            new THREE.Vector3(0, Math.random(), 0),
            new THREE.Vector3(Math.random(), 1, 0),
            new THREE.Vector3(1, Math.random(), 0)
        );
    }

    for (var i = 0; i < density * density; i++) {
        geometry.vertices.push(
            new THREE.Vector3(Math.random(), Math.random(), 0)
        );
    }

    geometry.vertices.forEach(function (vertex) {
        vertex.x -= 0.5;
        vertex.y -= 0.5;
        vertex.z = 0.01 * Math.random();
    });

    Delaunay.triangulate(geometry.vertices.map(function (vertex) {
        return [ vertex.x, vertex.y ];
    })).forEach(function (vertexIndex, indexIndex, vertexIndices) {
        if (indexIndex % 3 === 2) {
            geometry.faces.push(
                new THREE.Face3(
                    vertexIndices[indexIndex],
                    vertexIndices[indexIndex - 1],
                    vertexIndices[indexIndex - 2]
                )
            );
        }
    });

    //geometry.computeBoundingBox();
    geometry.computeFaceNormals();

    // var material = new THREE.MeshBasicMaterial({ color: 0x2d3741 }),
    var material = new THREE.MeshLambertMaterial(),
        crumple = new THREE.Mesh(geometry, material);

    scene.add(crumple);

    var ambient = new THREE.AmbientLight(0x404040);
    scene.add(ambient);

    // var directionalLight = new THREE.DirectionalLight(0xffffff, 0.3);
    // directionalLight.position.set(-0.5, -0.5, 1);
    // scene.add(directionalLight);

    var areaLight1 = new THREE.AreaLight(0xffffff, 1);
    areaLight1.position.set(0, 0, 1);
    areaLight1.lookAt(0, 0, 0);
    areaLight1.width = 1;
    areaLight1.height = 1;

    scene.add(areaLight1);

    camera.position.z = 1;

    function render() {
        renderer.render(scene, camera);
    }

    render();
};
</script>
</body>
</html>
